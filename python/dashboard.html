<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Dashboard ‚Äì Serveur Haute Performance</title>
  <style>
  :root {
    --bg-color: #fafafa;
    --text-color: #111111;
    --card-bg: #ffffff;
    --accent: #0d47a1;
    --accent-soft: #e3f2fd;
    --border-color: #cccccc;
  }
  body[data-theme="dark"] {
    --bg-color: #0b1020;
    --text-color: #f5f5f5;
    --card-bg: #161b2e;
    --accent: #90caf9;
    --accent-soft: #1e2746;
    --border-color: #394264;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: var(--bg-color);
    color: var(--text-color);
  }
  h1 { color: var(--accent); }
  h2 { color: var(--accent); }
  .card {
    background: var(--card-bg);
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid var(--border-color);
  }
  .perf-table, .summary-table, .compare-table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 1rem;
    font-size: 0.9rem;
  }
  .perf-table th, .summary-table th, .compare-table th {
    background: var(--accent-soft);
    padding: 8px;
    border: 1px solid var(--border-color);
    text-align: center;
  }
  .perf-table td, .summary-table td, .compare-table td {
    padding: 6px;
    border: 1px solid var(--border-color);
    text-align: center;
  }
  img {
    max-width: 650px;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    padding: 4px;
    margin: 8px;
  }
  .toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  .btn {
    border-radius: 4px;
    border: 1px solid var(--border-color);
    background: var(--accent-soft);
    color: var(--accent);
    padding: 0.4rem 0.8rem;
    cursor: pointer;
    font-size: 0.9rem;
  }
  .btn:hover {
    filter: brightness(1.05);
  }
  .slider-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 0.5rem;
  }
  .slider-row input[type="range"] {
    flex: 1;
  }
  </style>
</head>
<body data-theme="light">
<div class="toolbar">
  <h1>Dashboard ‚Äì Serveur Haute Performance</h1>
  <div>
    <button id="themeToggle" class="btn">Basculer mode sombre</button>
  </div>
</div>
<div class="card">
<h2>R√©sum√© statistique</h2>
<table class="dataframe summary-table">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>D√©bit moyen (req/s)</th>
      <th>Latence P99 moyenne (ms)</th>
      <th>CPU moyen (%)</th>
      <th>M√©moire moyenne (MB)</th>
    </tr>
    <tr>
      <th>server</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mono</th>
      <td>17.61</td>
      <td>4402.00</td>
      <td>0.06</td>
      <td>1.68</td>
    </tr>
    <tr>
      <th>multi</th>
      <td>120.29</td>
      <td>909.21</td>
      <td>0.67</td>
      <td>1.84</td>
    </tr>
  </tbody>
</table>
</div>
<div class="card">
<h2>üß† Analyse avanc√©e des performances</h2>
<p>Globalement, les mesures de benchmark montrent que le serveur multi-thread offre un d√©bit moyen d‚Äôenviron 120.3 requ√™tes par seconde, contre 17.6 req/s pour le serveur mono-thread. Sur l‚Äôensemble des configurations test√©es, cela correspond √† un gain moyen de performance d‚Äôenviron 6.83√ó en faveur de l‚Äôarchitecture multi-thread.</p>
<p>En termes de latence, la mesure P99 (latence subie par les 1 % de requ√™tes les plus lentes) reste plus favorable au serveur multi-thread, avec une P99 moyenne de 909.2 ms contre 4402.0 ms pour le mono-thread. Cela indique que le multi-thread absorbe mieux les pics de charge et r√©duit les ph√©nom√®nes de saturation lorsque le nombre de clients simultan√©s augmente.</p>
<p>√Ä la charge la plus √©lev√©e (‚âà 300 clients), on observe un d√©bit de 131.9 req/s pour le serveur multi-thread contre 17.0 req/s pour le mono-thread. La latence P99 atteint 7507.9 ms c√¥t√© mono, alors qu‚Äôelle est de 2109.2 ms c√¥t√© multi, ce qui confirme que le mono-thread atteint rapidement un plateau de performance tandis que le multi-thread continue √† exploiter les c≈ìurs CPU disponibles.</p>
<p>L‚Äôanalyse de l‚Äôutilisation CPU montre que les deux architectures finissent par saturer les c≈ìurs disponibles, mais le serveur multi-thread parvient √† transformer cette consommation CPU en d√©bit utile plus √©lev√© (CPU moyen ‚âà 0.7 % contre 0.1 % pour le mono-thread). La consommation m√©moire reste globalement ma√Ætris√©e pour les deux serveurs, avec une l√©g√®re surconsommation attendue c√¥t√© multi-thread li√©e √† la gestion des threads et de la file FIFO.</p>
<p>En pratique, l‚Äôarchitecture multi-thread avec file FIFO born√©e constitue le meilleur choix pour un environnement de production soumis √† des pics de charge importants, √† condition de ma√Ætriser la complexit√© de synchronisation et l‚Äôarr√™t propre des threads. Le serveur mono-thread conserve n√©anmoins un int√©r√™t p√©dagogique fort et peut √™tre adapt√© √† des sc√©narios simples ou √† faible charge, o√π la lisibilit√© du code prime sur la performance brute.</p>
</div>
<div class="card">
<h2>‚öñ Comparateur interactif Mono vs Multi</h2>
<p>Choisis un nombre de clients pour comparer les m√©triques entre le serveur mono-thread et le multi-thread. Le point de mesure le plus proche sera utilis√© pour chaque serveur.</p>
<div class="slider-row">
  <label for="clientSlider">Nombre de clients :</label>
  <input type="range" id="clientSlider" min="10" max="300" step="1" value="10">
  <span id="clientValue"></span>
</div>
<div id="compareOutput" style="margin-top:1rem;"></div>
</div>
<div class="card">
<h2>üìà Graphiques de performance</h2>
<div><img src="figures/1-throughput.png" alt="1-throughput.png"></div>
<div><img src="figures/2-latency_p99.png" alt="2-latency_p99.png"></div>
<div><img src="figures/3-cpu.png" alt="3-cpu.png"></div>
<div><img src="figures/4-memory.png" alt="4-memory.png"></div>
<div><img src="figures/5-speedup.png" alt="5-speedup.png"></div>
<div><img src="figures/6-saturation.png" alt="6-saturation.png"></div>
<div><img src="figures/THROUGHPUT_LIVE.png" alt="THROUGHPUT_LIVE.png"></div>
</div>
<script>
const DATA = [{"server": "mono", "clients": 10, "success": 10, "fail": 0, "mean": 281.7618912001308, "median": 308.03335649989094, "p95": 449.4062910007415, "p99": 449.4062910007415, "max_latency": 522.8355959998225, "cpu_mean": 0.0, "mem_mean": 1.68359375, "throughput_rps": 18.53230669195552, "time_total": 0.5395982360005291}, {"server": "mono", "clients": 50, "success": 50, "fail": 0, "mean": 1579.5187273999545, "median": 1614.4241250003688, "p95": 2928.80440800036, "p99": 3039.447262000067, "max_latency": 3060.6397049996303, "cpu_mean": 0.0, "mem_mean": 1.6796875, "throughput_rps": 16.201662471250497, "time_total": 3.0861030519999986}, {"server": "mono", "clients": 100, "success": 100, "fail": 0, "mean": 2679.029112540038, "median": 2723.7319764999484, "p95": 5010.186495000198, "p99": 5150.433558000259, "max_latency": 5220.341452999492, "cpu_mean": 0.18518518518518517, "mem_mean": 1.68359375, "throughput_rps": 18.999334894272977, "time_total": 5.2633421410000665}, {"server": "mono", "clients": 200, "success": 106, "fail": 94, "mean": 2941.7221484999454, "median": 2975.616967499718, "p95": 5676.691289999326, "p99": 5862.767098999939, "max_latency": 6018.806057999427, "cpu_mean": 0.0, "mem_mean": 1.6796875, "throughput_rps": 17.314574825111105, "time_total": 6.122009987000638}, {"server": "mono", "clients": 300, "success": 132, "fail": 168, "mean": 3559.2523219469804, "median": 3478.2091260003654, "p95": 6779.204254999968, "p99": 7507.921813999928, "max_latency": 7639.766799999961, "cpu_mean": 0.1282051282051282, "mem_mean": 1.68359375, "throughput_rps": 17.01143500567705, "time_total": 7.759486484000263}, {"server": "multi", "clients": 10, "success": 10, "fail": 0, "mean": 78.42541629988773, "median": 82.10794449951209, "p95": 97.76503699958994, "p99": 97.76503699958994, "max_latency": 127.18737300019711, "cpu_mean": 0.0, "mem_mean": 1.8359375, "throughput_rps": 75.42728709580786, "time_total": 0.13257801500003552}, {"server": "multi", "clients": 50, "success": 50, "fail": 0, "mean": 184.65423611987717, "median": 173.31036999985372, "p95": 338.8705719999052, "p99": 347.47329499987245, "max_latency": 366.7096950002815, "cpu_mean": 0.0, "mem_mean": 1.83984375, "throughput_rps": 126.65962229751854, "time_total": 0.39475879600013286}, {"server": "multi", "clients": 100, "success": 100, "fail": 0, "mean": 358.43262459999096, "median": 356.71761150024395, "p95": 668.6173099997177, "p99": 682.6759699997638, "max_latency": 722.2330730000976, "cpu_mean": 1.25, "mem_mean": 1.84375, "throughput_rps": 128.80027497521058, "time_total": 0.7763958579998871}, {"server": "multi", "clients": 200, "success": 200, "fail": 0, "mean": 702.0850761150132, "median": 713.2606630002556, "p95": 1270.817685000111, "p99": 1308.95234000036, "max_latency": 1328.3297980005955, "cpu_mean": 1.25, "mem_mean": 1.8515625, "throughput_rps": 138.67137609444623, "time_total": 1.442258710000715}, {"server": "multi", "clients": 300, "success": 300, "fail": 0, "mean": 1078.9812039799745, "median": 1081.948051999916, "p95": 2000.3730260004886, "p99": 2109.174191999955, "max_latency": 2133.7517890005984, "cpu_mean": 0.8333333333333334, "mem_mean": 1.8515625, "throughput_rps": 131.9158482368319, "time_total": 2.2741770909997285}];
const MIN_CLIENTS = 10;
const MAX_CLIENTS = 300;

function getNearestRow(clients, server) {
  const filtered = DATA.filter(r => r.server === server);
  if (filtered.length === 0) return null;
  let best = filtered[0];
  let bestDiff = Math.abs(filtered[0].clients - clients);
  for (let i = 1; i < filtered.length; i++) {
    const d = Math.abs(filtered[i].clients - clients);
    if (d < bestDiff) {
      bestDiff = d;
      best = filtered[i];
    }
  }
  return best;
}

function updateCompare() {
  const slider = document.getElementById("clientSlider");
  const valueSpan = document.getElementById("clientValue");
  const out = document.getElementById("compareOutput");
  if (!slider || !out || !valueSpan) return;

  const clients = parseInt(slider.value);
  valueSpan.textContent = clients;

  const mono = getNearestRow(clients, "mono");
  const multi = getNearestRow(clients, "multi");

  if (!mono || !multi) {
    out.innerHTML = "<p>Donn√©es insuffisantes pour cette configuration.</p>";
    return;
  }

  const thMono = mono.throughput_rps || 0.0;
  const thMulti = multi.throughput_rps || 0.0;
  const p99Mono = mono.p99 || 0.0;
  const p99Multi = multi.p99 || 0.0;
  const cpuMono = (mono.cpu_mean === null || mono.cpu_mean === undefined) ? 0.0 : mono.cpu_mean;
  const cpuMulti = (multi.cpu_mean === null || multi.cpu_mean === undefined) ? 0.0 : multi.cpu_mean;
  const memMono = (mono.mem_mean === null || mono.mem_mean === undefined) ? 0.0 : mono.mem_mean;
  const memMulti = (multi.mem_mean === null || multi.mem_mean === undefined) ? 0.0 : multi.mem_mean;

  const speedup = thMono > 0 ? (thMulti / thMono) : 0.0;

  out.innerHTML =
    '<table class="compare-table">' +
      '<thead><tr>' +
        '<th>M√©trique</th>' +
        '<th>Mono-thread</th>' +
        '<th>Multi-thread</th>' +
      '</tr></thead>' +
      '<tbody>' +
        '<tr><td>Clients (point le plus proche)</td>' +
          '<td>' + mono.clients + '</td>' +
          '<td>' + multi.clients + '</td></tr>' +
        '<tr><td>D√©bit (req/s)</td>' +
          '<td>' + thMono.toFixed(1) + '</td>' +
          '<td>' + thMulti.toFixed(1) + '</td></tr>' +
        '<tr><td>Latence P99 (ms)</td>' +
          '<td>' + p99Mono.toFixed(1) + '</td>' +
          '<td>' + p99Multi.toFixed(1) + '</td></tr>' +
        '<tr><td>CPU moyen (%)</td>' +
          '<td>' + cpuMono.toFixed(1) + '</td>' +
          '<td>' + cpuMulti.toFixed(1) + '</td></tr>' +
        '<tr><td>M√©moire moyenne (MB)</td>' +
          '<td>' + memMono.toFixed(1) + '</td>' +
          '<td>' + memMulti.toFixed(1) + '</td></tr>' +
        '<tr><td>Speedup multi / mono (d√©bit)</td>' +
          '<td colspan="2">' + speedup.toFixed(2) + '√ó</td></tr>' +
      '</tbody>' +
    '</table>';
}

function initTheme() {
  const saved = window.localStorage.getItem("dashboardTheme");
  const body = document.body;
  if (saved === "dark") {
    body.setAttribute("data-theme", "dark");
  } else {
    body.setAttribute("data-theme", "light");
  }
}

function toggleTheme() {
  const body = document.body;
  const current = body.getAttribute("data-theme") || "light";
  const next = (current === "light") ? "dark" : "light";
  body.setAttribute("data-theme", next);
  window.localStorage.setItem("dashboardTheme", next);
}

document.addEventListener("DOMContentLoaded", function () {
  initTheme();
  const slider = document.getElementById("clientSlider");
  if (slider) {
    slider.addEventListener("input", updateCompare);
    updateCompare();
  }
  const btn = document.getElementById("themeToggle");
  if (btn) {
    btn.addEventListener("click", toggleTheme);
  }
});

</script>
</body>
</html>